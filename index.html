<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic English Course</title>
<style>
    /* 1. Estilos Gerais */
    body {
        font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #FFFFFF; 
        color: #333;
    }

    /* 2. Layout da Grade de Cards e Spacing */
    #home-screen {
        max-width: 1200px;
        margin: 60px auto 50px; 
        padding: 0 30px;
    }
    
    h2 {
        color: #333;
        border-bottom: 1px solid #e0e0e0; 
        padding-top: 10px; 
        padding-bottom: 25px; 
        margin-bottom: 15px; 
        font-size: 2.2em; 
        font-weight: 500;
    }
    .chapter-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr); 
        gap: 15px;
    }
    
    @media (max-width: 1024px) {
        .chapter-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
    }

    /* 3. Estilos do Card */
    .chapter-card {
        background-color: #f7f7f7;
        border-radius: 6px; 
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); 
        cursor: pointer;
        height: 240px; 
        position: relative; 
        overflow: hidden;
        transition: box-shadow 0.2s ease;
    }
    .chapter-card:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }
    
    .card-background-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        z-index: 1;
    }

    .card-text-area {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 30%; 
        padding: 15px;
        z-index: 2; 
        transition: height 0.3s ease, background 0.3s ease, color 0.3s ease;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 100%); 
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }

    .chapter-card:hover .card-text-area {
        height: 50%;
        background: #FFFFFF; 
        justify-content: space-between; 
        padding: 15px; 
        align-items: flex-start; 
    }
    
    .text-content-wrapper {
        transition: transform 0.3s ease;
        text-align: left; 
        width: 100%; 
        box-sizing: border-box; 
    }

    .chapter-card:hover .text-content-wrapper { 
        transform: translateY(-5px);
    }

    .chapter-card h3 {
        margin-top: 0;
        font-size: 1.3em;
        margin-bottom: 5px;
        color: white; 
        transition: color 0.3s ease;
    }

    .chapter-card p {
        margin: 0;
        font-size: 0.8em;
        color: #ddd; 
        transition: color 0.3s ease;
    }
    
    .chapter-card:hover .card-text-area h3,
    .chapter-card:hover .card-text-area p {
        color: #000;
    }

    .start-button {
        background-color: #003366; 
        color: white;
        padding: 10px 22px;
        border: none;
        border-radius: 5px; 
        cursor: pointer;
        font-weight: bold;
        font-size: 1em; 
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transform: scale(0.9); 
        transition: opacity 0.3s ease, transform 0.3s ease, background-color 0.2s ease;
        align-self: flex-start;
    }

    .chapter-card:hover .start-button {
        opacity: 1; 
        transform: scale(1);
    }
    
    .start-button:hover {
        background-color: #004c99;
    }
    
    /* 4. Lesson/Quiz Screen */
    #lesson-screen {
        max-width: 650px;
        margin: 70px auto 40px; 
        padding: 30px;
        background-color: #FFFFFF; 
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05); 
        display: none;
        position: relative; 
    }
    
    /* Hotspot for Topic 5 */
    .hotspot {
        position: absolute;
        width: 35px; 
        height: 35px;
        background-color: #ffffff; 
        border: 2px solid #333; 
        color: #333; 
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.8em; 
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        z-index: 5;
        transition: transform 0.2s, background-color 0.2s;
        line-height: 0.8; 
    }
    
    .hotspot:hover {
        background-color: #f0f0f0;
        transform: scale(1.1);
    }

    /* Fixed Navigation Buttons (Right Corner) */
    .nav-buttons {
        position: fixed;
        top: 20px; 
        right: 20px; 
        z-index: 1000; 
        display: none; 
        gap: 10px; 
        align-items: center;
    }
    
    /* Back and Next Button Style */
    .nav-buttons button {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        color: white;
        background-color: #007bff;
        transition: background-color 0.2s;
    }
    
    .nav-buttons button:hover {
        background-color: #0056b3;
    }
    
    /* Progress Indicator */
    #progress-indicator {
        font-weight: 400;
        color: #333;
        font-size: 0.95em; 
        margin-right: 15px; 
    }

    /* Hamburger Menu Button (Top Left) */
    .menu-toggle {
        display: none;
        position: fixed; 
        top: 20px;
        left: 20px; 
        font-size: 2.2em; 
        background: none; 
        border: none;
        cursor: pointer;
        color: #333; 
        line-height: 1;
        padding: 5px 10px; 
        z-index: 1001; 
        transition: color 0.2s ease, background-color 0.2s ease;
        border-radius: 4px;
    }

    .menu-toggle:hover {
        color: #555; 
        background-color: #f0f0f0;
    }

    /* Side Menu (Left Side) */
    .side-menu {
        height: 100%;
        width: 0; 
        position: fixed; 
        z-index: 1000; 
        top: 0;
        left: 0;
        background-color: #ffffff;
        overflow-x: hidden; 
        transition: 0.3s; 
        padding-top: 60px;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1); 
        border-right: 1px solid #eee;
        overflow-y: auto;
    }

    .side-menu.open {
        width: 280px;
    }

    .side-menu a {
        padding: 15px 25px; 
        text-decoration: none;
        font-size: 1.1em; 
        color: #333; 
        display: block;
        transition: 0.3s;
        border-bottom: 1px solid #f0f0f0; 
        font-weight: 400;
    }

    .side-menu a:hover {
        background-color: #f6f9fc; 
        color: #007bff;
    }

    .side-menu .close-btn {
        position: absolute;
        top: 0;
        right: 15px;
        font-size: 36px;
        margin-left: 50px;
        color: #aaa;
        cursor: pointer;
    }

    /* Content Styles */
    .quiz-question img {
        max-width: 100%;
        height: auto; 
        display: block;
        margin: 15px auto;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .quiz-question {
        padding: 20px;
        border: 1px solid #eee;
        border-radius: 10px;
        margin-bottom: 25px;
        text-align: center;
        background-color: #fcfcfc;
        position: relative;
    }
    
    #question-text {
        font-size: 1.4em;
        font-weight: 500;
        margin-bottom: 10px;
    }
    
    .option {
        padding: 15px;
        margin: 12px 0;
        border-radius: 8px;
        border: 1px solid #ddd;
        cursor: pointer;
        transition: background-color 0.2s, border-color 0.2s;
        text-align: left;
    }
    
    /* NOVO ESTILO: Bordas elegantes para M√∫ltipla Escolha */
    .option.selected { border-color: #007bff;
    background-color: #f5f9ff; }
    .option.correct { border: 3px solid #28a745 !important; background-color: #e6ffed !important; font-weight: bold;
    }
    .option.incorrect { border: 3px solid #dc3545 !important; background-color: #ffe6e6 !important; font-weight: bold;
    }

    /* Pronunciation and Audio Styles */
    #pronunciation-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-top: 15px;
        border: 1px solid #ddd; 
        padding: 25px;
        border-radius: 10px;
    }
    .word-to-practice { font-size: 1.2em; font-weight: 700; margin-bottom: 20px; color: #333;
    }
    
    #audio-player-controls {
        width: 100%;
        max-width: 400px; 
        margin-bottom: 20px; 
    }
    
    #pronunciation-list { list-style: none; padding: 0; margin-top: 15px;
    width: 100%; max-width: 400px; text-align: left; }
    #pronunciation-list li { padding: 10px; border-bottom: 1px dotted #e0e0e0;
    display: flex; justify-content: space-between; align-items: center; font-size: 1.1em; }
    .play-button { background: none; border: none; font-size: 1.5em;
    cursor: pointer; color: #007bff; margin-left: 10px; transition: color 0.1s; }

    /* T√≥pico 3 e 5 - Table Styles */
    .info-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
        border-radius: 10px; 
        overflow: hidden;
    }
    
    /* MODIFICA√á√ÉO T√≥pico 3: Tabela de Vocabul√°rio menor e ajustes de cor */
    .lesson-vocabulary .info-table {
        margin: 10px auto;
        max-width: 400px; 
        border-radius: 6px;
        box-shadow: none; 
    }
    
    .lesson-vocabulary .info-table tr {
        border: 1px solid #e0e0e0;
        margin-bottom: 8px;
        display: block; 
        border-radius: 4px;
        overflow: hidden;
        transition: background-color 0.2s;
    }
    
    .lesson-vocabulary .info-table tr:hover {
        background-color: #f6f9fc;
    }
    
    .lesson-vocabulary .info-table th, .lesson-vocabulary .info-table td {
        padding: 10px 12px;
        /* Padding reduzido */
        text-align: left;
        border: none;
    }
    
    .lesson-vocabulary h3 {
        color: #333 !important;
        /* NOVO: Cinza Escuro */
        text-align: center;
        /* NOVO: Centralizado */
    }

    /* MODIFICA√á√ÉO T√≥pico 5: Modal de N√∫meros com escrita e n√∫mero separados */
    .modal-content .info-table {
        max-width: 250px;
        margin: 0 auto; 
        font-size: 0.9em; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        border: 1px solid #ddd;
    }
    
    .modal-content .info-table th {
        background-color: #f7f7f7;
        color: #333;
        font-weight: 600;
    }
    
    .modal-content .info-table td {
        padding: 8px 10px;
    }
    
    .modal-content .info-table td:first-child {
        font-weight: 700;
        /* Letras mais grossas */
        border-right: 1px solid #eee;
        /* Linha de separa√ß√£o */
    }


    /* Estilo para a coluna de palavras (Topic 3) */
    .info-table td.sentence-cell {
        font-weight: 400;
        color: #333; 
    }
    .info-table td.sentence-cell .highlight {
        font-weight: bold;
        color: #007bff; 
    }


    /* Topic 6 Comparison Table Styles */
    .comparison-table {
        width: 100%;
        max-width: 400px;
        border-collapse: collapse;
        margin: 20px auto;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .comparison-table th, .comparison-table td {
        border: 1px solid #ddd;
        padding: 10px; 
        text-align: center;
        font-size: 1em; 
    }
    .comparison-table th {
        background-color: #f2f2f2;
        color: #333;
    }
    .comparison-table tr:nth-child(even) {
        background-color: #fff;
    }
    .comparison-table tr:nth-child(odd) {
        background-color: #f9f9f9;
    }
    
    /* Topic 7 (FILL_IN_BLANKS) Styles */
    .fill-in-blanks-container {
        display: flex;
        flex-direction: column; 
        align-items: center; 
        gap: 4px; 
        padding: 5px 0; 
    }

    .number-input-group {
        display: flex;
        flex-direction: column; 
        align-items: flex-start;
        gap: 2px; 
        width: 80%; 
        max-width: 200px; 
        padding: 3px; 
        border: 1px solid #eee;
        border-radius: 6px;
        background-color: #f9f9f9;
        transition: background-color 0.2s;
    }

    .number-input-group span {
        font-size: 1.1em;
        font-weight: 700;
        color: #333; 
        width: 100%; 
        text-align: left;
        margin-bottom: 2px;
    }

    .number-input-group input {
        width: 100%; 
        padding: 8px 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 0.9em; 
        transition: border-color 0.2s;
        text-transform: lowercase; 
        box-sizing: border-box;
    }

    .number-input-group input:focus {
        border-color: #007bff;
        outline: none;
    }
    
    .number-result {
        margin-top: 3px;
        font-weight: bold;
        text-align: left; 
        width: 100%; 
        font-size: 0.85em; 
    }

    .result-correct { color: #28a745;
    }
    .result-incorrect { color: #dc3545; }

    /* Topic 8 (Drag and Drop) Styles */
    .drag-drop-overall-container {
        display: flex;
        flex-direction: column;
        align-items: center; 
        width: 100%;
        max-width: 600px; 
        margin: 0 auto; 
        padding: 20px 0;
    }

    /* 1. Image Gallery */
    .image-gallery-container {
        width: 100%;
        display: grid;
        grid-template-columns: repeat(2, 1fr); 
        gap: 15px; 
        margin-bottom: 30px; 
    }

    .gallery-image-wrapper {
        position: relative;
        width: 100%;
        height: 320px; 
        border-radius: 10px; 
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .gallery-image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        background-color: #fcfcfc;
        display: block;
    }

    /* MODIFICA√á√ÉO T√≥pico 8: Ajustes de foco para melhor centraliza√ß√£o */
    .gallery-image-wrapper:nth-child(1) img { 
        object-position: center 25%;
        /* Ajuste fino */
    }
    .gallery-image-wrapper:nth-child(3) img { 
        object-position: center 5%;
        /* Ajuste fino para evitar corte de cabe√ßa */
    }
    

    .image-number-label {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 6px;
        font-size: 1.1em;
        font-weight: bold;
        z-index: 10;
    }

    @media (max-width: 480px) {
        .image-gallery-container {
            grid-template-columns: 1fr;
        }
        .gallery-image-wrapper {
            height: 250px;
        }
    }

    /* 2. Sentence List */
    .sentence-list-container {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 12px; 
        margin-bottom: 30px; 
    }

    .sentence-item {
        display: flex;
        align-items: center;
        justify-content: flex-start; 
        font-size: 1.1em; 
        font-weight: 500;
        line-height: 1.4;
        margin: 0;
        padding: 3px 0;
    }

    .sentence-text-before {
        margin-right: 5px;
    }

    /* Drop Zone */
    .drop-zone {
        min-width: 120px;
        min-height: 2.2em; 
        border: 1px solid #cccccc; 
        border-radius: 6px; 
        padding: 3px 8px; 
        line-height: 1.3; 
        display: inline-flex; 
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
        flex-grow: 0; 
        transition: background-color 0.1s, border-color 0.1s;
        white-space: nowrap;
    }
    
    .drop-zone.drag-over {
        background-color: #eef7ff;
        border-color: #007bff; 
    }

    /* NOVO ESTILO: Bordas mais limpas para corre√ß√£o de Drag and Drop */
    .drop-zone.correct-drop {
        border: 2px solid #28a745 !important;
        background-color: #ffffff; /* Fundo limpo */
    }

    .drop-zone.incorrect-drop {
        border: 2px solid #dc3545 !important;
        background-color: #ffffff; /* Fundo limpo */
    }

    /* 3. Draggable Words Container */
    .draggable-words-container {
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: center; 
        gap: 10px; 
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background-color: #f8f8f8;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.02); 
    }

    /* Draggable Word */
    .draggable-word {
        cursor: grab;
        background-color: #ffffff; 
        color: #333; 
        padding: 9px 18px; 
        border-radius: 18px; 
        font-size: 0.95em; 
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        border: 1px solid #e0e0e0; 
        transition: opacity 0.2s, transform 0.1s, background-color 0.2s, box-shadow 0.2s;
    }
    
    .draggable-word:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
    }
    
    .draggable-word.dragging {
        opacity: 0.6;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
        transform: scale(0.98);
    }
    
    /* Dropped Word Style */
    .drop-zone .draggable-word {
        cursor: default;
        box-shadow: none;
        margin: 0; 
        padding: 5px 10px; 
        font-size: 0.9em;
        background-color: #e8f0fe; 
        border-color: #c0d8f8;
        color: #004085;
        font-weight: 600;
        display: block;
    }

    /* NOVO ESTILO: Fundo limpo para a corre√ß√£o */
    .correct-word-display {
        background-color: transparent !important;
        /* Fundo transparente */
        color: #dc3545 !important;
        /* Texto da palavra correta em vermelho */
        padding: 0; 
        font-weight: bold;
        font-size: 0.9em; 
    }

    /* Estilos do Modal (T√≥pico 5) */
    .modal {
        display: none;
        /* CORRIGIDO: Esconde por padr√£o */
        position: fixed; 
        z-index: 1002; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.4);
        /* Novos estilos para anima√ß√£o/esconder instantaneamente */
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        justify-content: center; 
        align-items: center; 
    }
    
    /* Nova classe para exibir o modal com anima√ß√£o */
    .modal.show-modal {
        display: flex;
        /* Usa flex para centralizar APENAS quando show-modal √© ativado */
        opacity: 1;
    }

    .modal-content {
        background-color: transparent; 
        padding: 0; 
        border: none;
        box-shadow: none; 
        width: auto; 
        max-width: 90%; 
        margin: 0;
    }

    .modal-content-wrapper {
        background-color: #fefefe; 
        padding: 20px; 
        border: 1px solid #888;
        border-radius: 10px; 
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        margin-left: 10px;
    }
    
    .close-button:hover,
    .close-button:focus {
        color: #000;
        text-decoration: none;
    }
</style>
</head>
<body>

<div id="home-screen">
    <h2>BEGINNER</h2>
    <div class="chapter-grid">
        </div>
</div>

<div id="lesson-screen">
    <div class="quiz-question">
        <img id="question-image" src="" alt="Lesson Image">
        <div class="hotspot" id="hotspot-1" style="top: 20%; left: 20%;" onclick="openNumberModal('one-to-ten')">+</div>
        <div class="hotspot" id="hotspot-2" style="top: 20%; left: 70%;" onclick="openNumberModal('tens')">+</div>
        <div class="hotspot" id="hotspot-3" style="top: 70%; left: 20%;" onclick="openNumberModal('teens')">+</div>
        <div class="hotspot" id="hotspot-4" style="top: 70%; left: 70%;" onclick="openNumberModal('combined')">+</div>
    </div>

    <p id="question-text" style="display: none;"></p>

    <div id="options-container" style="display: none;">
        </div>

    <div id="pronunciation-container" style="display: none;">
        <p class="word-to-practice" id="current-instruction"></p>
        <audio id="audio-player-controls" controls preload="auto"></audio>
        <div id="comparison-table-container"></div>
        <ul id="pronunciation-list"></ul>
    </div>
    
    <p id="feedback" style="font-weight: bold; margin-top: 15px; text-align: center;"></p>
</div>

<div class="nav-buttons">
    <span id="progress-indicator"></span>
    <button id="back-btn" onclick="backQuestion()">Back</button>
    <button id="next-btn" onclick="nextQuestion()">Next</button>
</div>

<button class="menu-toggle" onclick="openNav()">‚ò∞</button>

<div id="side-menu" class="side-menu">
    <a href="javascript:void(0)" class="close-btn" onclick="closeNav()">&times;</a>
    <a href="javascript:void(0)" style="font-weight: bold; color: #007bff;" onclick="goHome()">üè† Home</a>
    </div>

<div id="numberModal" class="modal" onclick="closeNumberModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-content-wrapper">
            <span class="close-button" onclick="closeNumberModal()">&times;</span>
            <h3 id="modal-title" style="text-align: center; color: #333; margin-top: 5px;"></h3>
            <div id="modal-body" style="text-align: center;">
                </div>
        </div>
    </div>
</div>

<script>
// --- GLOBAL CONSTANTS ---
const GITHUB_RAW_BASE_URL = 'https://raw.githubusercontent.com/YourUsername/YourRepo/main/';
const BACKGROUND_IMAGES = [
    GITHUB_RAW_BASE_URL + 'cards.jpg',
    GITHUB_RAW_BASE_URL + 'bg2.jpg',
    GITHUB_RAW_BASE_URL + 'bg3.jpg',
    GITHUB_RAW_BASE_URL + 'bg4.jpg',
    GITHUB_RAW_BASE_URL + 'bg5.jpg'
];

// Data for Drag & Drop (T√≥pico 8)
const DRAG_AND_DROP_WORDS = [
    { id: 'word-1', text: 'Friend' },
    { id: 'word-2', text: 'Teacher' },
    { id: 'word-3', text: 'American' },
    { id: 'word-4', text: 'Student' }
];

const DRAG_AND_DROP_SENTENCES = [
    { id: 1, text: 'This is my ____ John.', correct: 'Friend', image: GITHUB_RAW_BASE_URL + 'img/drag-friend.jpg' },
    { id: 2, text: 'She is a great ____.', correct: 'Teacher', image: GITHUB_RAW_BASE_URL + 'img/drag-teacher.jpg' },
    { id: 3, text: 'I am an ____ student.', correct: 'American', image: GITHUB_RAW_BASE_URL + 'img/drag-american.jpg' },
    { id: 4, text: 'Are you a ____?', correct: 'Student', image: GITHUB_RAW_BASE_URL + 'img/drag-student.jpg' }
];

// --- LESSON DATA ---
const QUESTIONS = [
    // T√≥pico 1 - Quiz: Numbers Overview
    {
        id: 1,
        question: "What do you see in the image?",
        image: "numeros.jpg",
        options: {
            A: "The Alphabet",
            B: "Colors",
            C: "Numbers"
        },
        correctAnswer: 'C',
        correctWord: 'Numbers',
        chapter: 1,
        title: "1. Numbers Overview"
    },
    // T√≥pico 2 - Quiz: Verb 'To Be' (I am)
    {
        id: 2,
        question: "Complete the self-introduction: 'Hello, ____ Marcus.'",
        image: "cumprimento.jpg",
        options: {
            A: "I is",
            B: "I am",
            C: "I are"
        },
        correctAnswer: 'B',
        correctWord: 'I am',
        chapter: 1,
        title: "2. Verb 'To Be' (I am)"
    },
    // T√≥pico 3 - Vocabulary (Tabela menor e cor do t√≠tulo)
    {
        id: 3,
        question: `<h3 style="color: #333; font-size: 2em; margin-bottom: 20px; text-align: center;">Vocabulary</h3>`,
        correctAnswer: 'INFO_TABLE',
        chapter: 1,
        title: "3. Lesson Vocabulary",
        options: [
            { word: 'address number', example: 'My <span class="highlight">address number</span> is 34.'
            },
            { word: 'student', example: 'I am a <span class="highlight">student</span>.'
            },
            { word: 'friend', example: 'He is my new <span class="highlight">friend</span>, David.' },
            { word: 'great', example: 'Mr.
                David is a <span class="highlight">great</span> teacher.' },
            { word: 'phone number', example: 'My <span class="highlight">phone number</span> is: (987) 654-1234.'
            },
            { word: 'American', example: 'Sofia is <span class="highlight">American</span>.' },
            { word: 'teacher', example: 'I love my English <span class="highlight">teacher</span>.'
            },
            { word: 'new', example: 'Lucas is a <span class="highlight">new</span> student, too.'
            },
            { word: 'very well', example: 'I am doing <span class="highlight">very well</span>, thanks.'
            }
        ]
    },
    // T√≥pico 4 - Pronunciation: Numbers 1-10
    {
        id: 4,
        question: "Practice the pronunciation of the numbers 1 to 10.",
        correctAnswer: 'PRONUNCIATION_SET',
        chapter: 1,
        title: "4. Pronunciation: Numbers 1-10",
        data: [
            { word: 'One', audio: 'audio/one.mp3' },
            { word: 'Two', audio: 'audio/two.mp3' },
            { word: 'Three', audio: 'audio/three.mp3' },
            { word: 'Four', audio: 'audio/four.mp3' },
            { word: 'Five', audio: 'audio/five.mp3' },
            { word: 'Six', audio: 'audio/six.mp3' },
            { word: 'Seven', audio: 'audio/seven.mp3' },
            { word: 'Eight', audio: 'audio/eight.mp3' },
            { word: 'Nine', audio: 'audio/nine.mp3' },
            { word: 'Ten', audio: 'audio/ten.mp3' }
        ]
    },
    // T√≥pico 5 - Interactive Bingo Review
    {
        id: 5,
        question: "Review the numbers categories by clicking on the hotspots.",
        image: "bingo.jpg",
        correctAnswer: 'INTERACTIVE_BINGO',
        chapter: 1,
        title: "5. Interactive Bingo Review",
        // Content is dynamically loaded by openNumberModal function
    },
    // T√≥pico 6 - Pronunciation: 10s vs Teens
    {
        id: 6,
        question: "Compare the pronunciation of 'tens' and 'teens' numbers.",
        correctAnswer: 'PRONUNCIATION_SET',
        chapter: 1,
        title: "6. Pronunciation: Tens vs Teens",
        data: [
            { word: 'Thirteen', audio: 'audio/thirteen.mp3', comparison: 'Thirty', comparisonAudio: 'audio/thirty.mp3' },
            { word: 'Fourteen', audio: 'audio/fourteen.mp3', comparison: 'Forty', comparisonAudio: 'audio/forty.mp3' },
            { word: 'Fifteen', audio: 'audio/fifteen.mp3', comparison: 'Fifty', comparisonAudio: 'audio/fifty.mp3' },
            { word: 'Sixteen', audio: 'audio/sixteen.mp3', comparison: 'Sixty', comparisonAudio: 'audio/sixty.mp3' },
            { word: 'Seventeen', audio: 'audio/seventeen.mp3', comparison: 'Seventy', comparisonAudio: 'audio/seventy.mp3' },
            { word: 'Eighteen', audio: 'audio/eighteen.mp3', comparison: 'Eighty', comparisonAudio: 'audio/eighty.mp3' },
            { word: 'Nineteen', audio: 'audio/nineteen.mp3', comparison: 'Ninety', comparisonAudio: 'audio/ninety.mp3' }
        ]
    },
    // T√≥pico 7 - Fill in the Blanks: Writing Numbers
    {
        id: 7,
        question: "Write the numbers in English:",
        correctAnswer: 'FILL_IN_BLANKS',
        chapter: 1,
        title: "7. Writing Numbers Practice",
        data: [
            { num: 10, correct: "ten" },
            { num: 22, correct: "twenty-two" },
            { num: 36, correct: "thirty-six" },
            { num: 12, correct: "twelve" },
            { num: 44, correct: "forty-four" },
            { num: 99, correct: "ninety-nine" },
            { num: 8, correct: "eight" },
            { num: 57, correct: "fifty-seven" },
            { num: 60, correct: "sixty" },
            { num: 16, correct: "sixteen" }
        ]
    },
    // T√≥pico 8 - Drag & Drop: Vocabulary
    {
        id: 8,
        question: "Drag the correct word to complete the sentences based on the images.",
        correctAnswer: 'DRAG_AND_DROP',
        chapter: 1,
        title: "8. Drag & Drop: Vocabulary",
        data: {
            words: DRAG_AND_DROP_WORDS,
            sentences: DRAG_AND_DROP_SENTENCES
        }
    },
    // T√≥pico 9 ao 13 - Quizzes de M√∫ltipla Escolha
    {
        id: 9,
        question: "What is the color of the sky on a sunny day?",
        image: "",
        options: {
            A: "Red",
            B: "Yellow",
            C: "Blue"
        },
        correctAnswer: 'C',
        correctWord: 'Blue',
        chapter: 1,
        title: "9. Quiz: Colors"
    },
    {
        id: 10,
        question: "What is the English word for 'cadeira'?",
        image: "",
        options: {
            A: "Book",
            B: "Chair",
            C: "Table"
        },
        correctAnswer: 'B',
        correctWord: 'Chair',
        chapter: 1,
        title: "10. Quiz: Objects"
    },
    {
        id: 11,
        question: "Identify the color of the object in the image:",
        image: "apple.jpg",
        options: {
            A: "Green",
            B: "Red",
            C: "Orange"
        },
        correctAnswer: 'B',
        correctWord: 'Red',
        chapter: 1,
        title: "11. Quiz: Image Color"
    },
    {
        id: 12,
        question: "How do you ask 'Where are you from?'",
        image: "",
        options: {
            A: "What your name is?",
            B: "Where from you are?",
            C: "Where are you from?"
        },
        correctAnswer: 'C',
        correctWord: 'Where are you from?',
        chapter: 1,
        title: "12. Quiz: Basic Questions"
    },
    {
        id: 13,
        question: "Select the correct way to say 'Eu sou professor' in English:",
        image: "",
        options: {
            A: "I am a teacher",
            B: "I is teacher",
            C: "I teacher am"
        },
        correctAnswer: 'A',
        correctWord: 'I am a teacher',
        chapter: 1,
        title: "13. Quiz: Sentence Structure"
    }
];

// --- JAVASCRIPT LOGIC ---
let currentChapter = 1;
let currentQuestionIndex = 0;
let lessonQuestions = [];
let selectedOption = null;
let currentDraggedElement = null; // For Drag and Drop

// DOM Elements
const homeScreen = document.getElementById('home-screen');
const lessonScreen = document.getElementById('lesson-screen');
const optionsContainer = document.getElementById('options-container');
const feedback = document.getElementById('feedback');
const nextBtn = document.getElementById('next-btn');
const backBtn = document.getElementById('back-btn');
const questionText = document.getElementById('question-text');
const questionImage = document.getElementById('question-image');
const progressIndicator = document.getElementById('progress-indicator');
const sideMenu = document.getElementById('side-menu');
const navButtonsContainer = document.querySelector('.nav-buttons');
const menuToggle = document.querySelector('.menu-toggle');
let answerChecked = false; // Controla se a resposta (ou check) j√° foi processada

// RENDER CHAPTER CARDS ON HOME SCREEN
const chapterGrid = document.querySelector('.chapter-grid');
for (let i = 1; i <= 24; i++) {
    // FIX APLICADO: Agora a vari√°vel bgUrl √© usada corretamente na URL da imagem de fundo.
    const bgUrl = BACKGROUND_IMAGES[(i - 1) % BACKGROUND_IMAGES.length];
    let cardTopicName = i === 1 ? 'Basic Foundations (13 Topics Ready!)' : `Module ${i} Content`;
    chapterGrid.innerHTML += `
        <div class="chapter-card" id="card-${i}">
            <div class="card-background-image" style="background-image: url('${bgUrl}');"></div>
            <div class="card-text-area">
                <div class="text-content-wrapper">
                    <h3>Beginner ${i}</h3>
                    <p>${cardTopicName}</p>
                </div>
                <button class="start-button" onclick="startLesson(${i}); event.stopPropagation();">Start</button>
            </div>
        </div>
    `;
}

// --- GENERAL NAVIGATION AND LOADING FUNCTIONS ---
function openNav() {
    sideMenu.classList.add('open');
}

function closeNav() {
    sideMenu.classList.remove('open');
}

// ATUALIZADO: Usando closeNumberModal para fechar o modal.
window.onclick = function(event) {
    if (sideMenu.classList.contains('open') && !event.target.closest('.side-menu') && !event.target.closest('.menu-toggle')) {
        closeNav();
    }
    const modal = document.getElementById('numberModal');
    // Se o clique foi no background do modal, fechar
    if (event.target == modal) {
        closeNumberModal();
    }
}

function loadQuestionFromMenu(index) {
    closeNav();
    currentQuestionIndex = index;
    loadQuestion(lessonQuestions[currentQuestionIndex]);
}

function populateMenu() {
    sideMenu.querySelectorAll('a:not(.close-btn)').forEach(a => a.remove());

    lessonQuestions.forEach((q, index) => {
        const link = document.createElement('a');
        link.textContent = q.title;
        link.href = `javascript:void(0)`;
        link.onclick = () => loadQuestionFromMenu(index);
        sideMenu.appendChild(link);
    });
}

function startLesson(chapterNumber) {
    currentChapter = chapterNumber;
    lessonQuestions = QUESTIONS.filter(q => q.chapter === chapterNumber);
    currentQuestionIndex = 0;
    
    // Hide home screen, show lesson screen
    homeScreen.style.display = 'none';
    lessonScreen.style.display = 'block';
    navButtonsContainer.style.display = 'flex';
    menuToggle.style.display = 'block';
    
    // Populate the side menu
    populateMenu();

    // Load the first question
    loadQuestion(lessonQuestions[currentQuestionIndex]);
}

function goHome() {
    homeScreen.style.display = 'block';
    lessonScreen.style.display = 'none';
    navButtonsContainer.style.display = 'none';
    menuToggle.style.display = 'none';
}

function updateProgress() {
    const totalQuestions = lessonQuestions.length;
    const currentNumber = currentQuestionIndex + 1;
    progressIndicator.textContent = `Topic ${currentNumber} of ${totalQuestions}`;
}

function loadQuestion(q) {
    // Reset state
    answerChecked = false;
    feedback.innerHTML = '';
    optionsContainer.innerHTML = '';
    document.getElementById('pronunciation-container').style.display = 'none';
    document.getElementById('comparison-table-container').innerHTML = '';
    document.getElementById('hotspot-1').style.display = 'none';
    document.getElementById('hotspot-2').style.display = 'none';
    document.getElementById('hotspot-3').style.display = 'none';
    document.getElementById('hotspot-4').style.display = 'none';
    
    // Always show question text first
    questionText.style.display = 'block';
    questionText.innerHTML = q.question;

    // Load image if available
    if (q.image) {
        questionImage.src = GITHUB_RAW_BASE_URL + 'img/' + q.image;
        questionImage.style.display = 'block';
    } else {
        questionImage.style.display = 'none';
    }

    switch (q.correctAnswer) {
        case 'INFO_TABLE': 
            loadInfoTable(q);
            break;
        case 'PRONUNCIATION_SET':
            loadPronunciationSlide(q);
            break;
        case 'INTERACTIVE_BINGO':
            questionImage.style.display = 'block';
            document.getElementById('hotspot-1').style.display = 'flex';
            document.getElementById('hotspot-2').style.display = 'flex';
            document.getElementById('hotspot-3').style.display = 'flex';
            document.getElementById('hotspot-4').style.display = 'flex';
            optionsContainer.innerHTML = '';
            optionsContainer.style.display = 'none';
            feedback.innerHTML = ''; 
            break;
        case 'FILL_IN_BLANKS':
            loadFillInBlanks(q);
            break;
        case 'DRAG_AND_DROP':
            loadDragAndDrop(q);
            questionImage.style.display = 'none';
            break;
        default: // M√∫ltipla Escolha
            loadQuizSlide(q);
            // ALTERA√á√ÉO SOLICITADA APLICADA: Frase de feedback removida
            break;
    }

    // Update navigation and progress
    backBtn.style.display = currentQuestionIndex === 0 ? 'none' : 'block';
    updateProgress();
}

function nextQuestion() {
    const currentQ = lessonQuestions[currentQuestionIndex];

    // 1. Check answer if it's a quiz (Multiple Choice, Fill in Blanks, Drag & Drop)
    if (!answerChecked) {
        switch (currentQ.correctAnswer) {
            case 'INTERACTIVE_BINGO':
            case 'INFO_TABLE':
            case 'PRONUNCIATION_SET':
                // For info-only slides, just proceed without checking
                break; 
            case 'FILL_IN_BLANKS':
                checkFillInBlanks(currentQ);
                answerChecked = true;
                return;
            case 'DRAG_AND_DROP':
                checkDragAndDrop(currentQ);
                answerChecked = true;
                return;
            default: // M√∫ltipla Escolha
                if (!selectedOption) {
                    feedback.innerHTML = '<span style="color: #dc3545;">Please select an option or click Next to skip and see the answer.</span>';
                    return;
                }
                // Se a resposta for selecionada, verifica e marca como verificada antes de avan√ßar.
                checkAnswer(selectedOption, currentQ.correctAnswer, currentQ.options);
                answerChecked = true;
                return;
        }
    }

    // 2. AVAN√áA PARA A PR√ìXIMA PERGUNTA
    currentQuestionIndex++;
    if (currentQuestionIndex < lessonQuestions.length) {
        loadQuestion(lessonQuestions[currentQuestionIndex]);
    } else {
        // End of module
        alert(`Congratulations! You have completed the Beginner ${currentChapter} level.`);
        goHome();
    }
}

function backQuestion() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion(lessonQuestions[currentQuestionIndex]);
    } else {
        goHome();
    }
}

// --- FUN√á√ïES AUXILIARES DE CARREGAMENTO ---
function loadQuizSlide(q) {
    optionsContainer.style.display = 'block';
    optionsContainer.innerHTML = '';
    selectedOption = null; // Reseta a op√ß√£o selecionada

    for (const [key, value] of Object.entries(q.options)) {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option';
        optionDiv.innerHTML = `${key}. ${value}`;
        optionDiv.setAttribute('data-key', key);
        optionDiv.onclick = (e) => {
            if (answerChecked) return;
            // Limpa sele√ß√£o anterior
            Array.from(optionsContainer.children).forEach(div => div.classList.remove('selected'));
            // Marca nova sele√ß√£o
            optionDiv.classList.add('selected');
            selectedOption = optionDiv;
        };
        optionsContainer.appendChild(optionDiv);
    }
}

// Fun√ß√£o para carregar Tabela de Informa√ß√£o (T√≥pico 3)
function loadInfoTable(q) {
    optionsContainer.style.display = 'block';
    optionsContainer.innerHTML = `<div class="lesson-vocabulary"></div>`;
    const container = optionsContainer.querySelector('.lesson-vocabulary');

    const tableHTML = `
        <table class="info-table">
            <tbody>
                ${q.options.map(item => `
                    <tr>
                        <td>${item.word}</td>
                        <td class="sentence-cell">${item.example}</td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;

    container.innerHTML = q.question + tableHTML; // Coloca o t√≠tulo ajustado dentro do container
    questionText.style.display = 'none'; // Esconde o texto da pergunta
    optionsContainer.style.display = 'block';
}

// T√≥pico 4 e 6 - Pronunciation Slide
function loadPronunciationSlide(q) {
    document.getElementById('pronunciation-container').style.display = 'flex';
    questionText.innerHTML = '';
    questionText.style.display = 'none';
    optionsContainer.style.display = 'none';
    
    document.getElementById('current-instruction').textContent = q.question;
    document.getElementById('audio-player-controls').style.display = 'none'; // Hide main player

    const list = document.getElementById('pronunciation-list');
    list.innerHTML = '';

    if (q.data.some(item => item.comparison)) {
        // T√≥pico 6: Compara√ß√£o de pron√∫ncia (10s vs Teens)
        const compContainer = document.getElementById('comparison-table-container');
        compContainer.innerHTML = `
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Teen (Accent on second syllable)</th>
                        <th>Ten (Accent on first syllable)</th>
                    </tr>
                </thead>
                <tbody>
                    ${q.data.map(item => `
                        <tr>
                            <td>
                                <span>${item.word}</span> 
                                <button class="play-button" onclick="playAudio('${GITHUB_RAW_BASE_URL}${item.audio}')">‚ñ∂Ô∏è</button>
                            </td>
                            <td>
                                <span>${item.comparison}</span> 
                                <button class="play-button" onclick="playAudio('${GITHUB_RAW_BASE_URL}${item.comparisonAudio}')">‚ñ∂Ô∏è</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    } else {
        // T√≥pico 4: Lista simples de palavras (Numbers 1-10)
        q.data.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${item.word}</span>
                <button class="play-button" onclick="playAudio('${GITHUB_RAW_BASE_URL}${item.audio}')">‚ñ∂Ô∏è</button>
            `;
            list.appendChild(li);
        });
    }
}

// Fun√ß√£o para tocar √°udio individual (usado no T√≥pico 4)
function playAudio(src) {
    const tempAudio = new Audio(src);
    tempAudio.play();
}

function checkAnswer(selectedDiv, correctAnswerKey, options) {
    if (answerChecked) return;
    
    const correctWord = options[correctAnswerKey]; // Pega a palavra correta

    // Limpa todas as op√ß√µes
    Array.from(optionsContainer.children).forEach(div => {
        div.style.pointerEvents = 'none';
        div.classList.remove('selected', 'correct', 'incorrect');
    });

    // Marca a op√ß√£o correta e a selecionada
    Array.from(optionsContainer.children).forEach(div => {
        const optionKey = div.getAttribute('data-key');
        if (optionKey === correctAnswerKey) {
            div.classList.add('correct');
        } else if (selectedDiv && div === selectedDiv) {
            div.classList.add('incorrect');
        }
    });

    if (selectedDiv && selectedDiv.getAttribute('data-key') === correctAnswerKey) {
        feedback.innerHTML = `<span style="color: #28a745;">Correct! The answer is **${correctWord}**. Click Next to continue.</span>`;
    } else {
        // Se selectedDiv for null, significa que o usu√°rio n√£o selecionou e clicou next.
        // OU se selecionou, mas estava incorreto.
        if (!selectedDiv) {
            feedback.innerHTML = `<span style="color: #dc3545;">Skipped.</span> The correct answer is: **${correctWord}**.
            Click Next to continue.`;
        } else {
            feedback.innerHTML = `<span style="color: #dc3545;">Incorrect.</span> The correct answer is: **${correctWord}**.
            Click Next to continue.`;
        }
        // Garante que a correta seja marcada
        Array.from(optionsContainer.children).forEach(div => {
            const optionKey = div.getAttribute('data-key');
            if (optionKey === correctAnswerKey) {
                div.classList.add('correct');
            }
        });
    }
    answerChecked = true;
}

// O c√≥digo para o T√≥pico 5 (Interactive Bingo Review) - Modal
function openNumberModal(group) {
    const modal = document.getElementById('numberModal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    modalBody.innerHTML = '';
    let title = '';
    let numbers = [];

    switch (group) {
        case 'one-to-ten':
            title = 'Numbers 1-10';
            numbers = [
                ['one', '1'],
                ['two', '2'],
                ['three', '3'],
                ['four', '4'],
                ['five', '5'],
                ['six', '6'],
                ['seven', '7'],
                ['eight', '8'],
                ['nine', '9'],
                ['ten', '10']
            ];
            break;
        case 'tens':
            title = 'Tens Numbers (10, 20, 30...)';
            numbers = [
                ['ten', '10'],
                ['twenty', '20'],
                ['thirty', '30'],
                ['forty', '40'],
                ['fifty', '50'],
                ['sixty', '60'],
                ['seventy', '70'],
                ['eighty', '80'],
                ['ninety', '90']
            ];
            break;
        case 'teens':
            title = 'Teens Numbers (13-19)';
            numbers = [
                ['thirteen', '13'],
                ['fourteen', '14'],
                ['fifteen', '15'],
                ['sixteen', '16'],
                ['seventeen', '17'],
                ['eighteen', '18'],
                ['nineteen', '19']
            ];
            break;
        case 'combined':
            title = 'Combined Numbers (21-99)';
            // ALTERA√á√ÉO SOLICITADA APLICADA AQUI
            numbers = [
                ['twenty-one', '21'],
                ['thirty-two', '32'],
                ['forty-three', '43'],
                ['fifty-four', '54'],
                ['sixty-five', '65'],
                ['seventy-six', '76'],
                ['eighty-seven', '87'],
                ['ninety-eight', '98']
            ];
            break;
    }

    modalTitle.textContent = title;
    const tableHTML = `
        <table class="info-table">
            <thead>
                <tr>
                    <th>Word</th>
                    <th>Number</th>
                </tr>
            </thead>
            <tbody>
                ${numbers.map(item => `
                    <tr>
                        <td>${item[0]}</td>
                        <td>${item[1]}</td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
    modalBody.innerHTML = tableHTML;

    // CORRIGIDO: Garante que o display seja ativado antes da transi√ß√£o.
    modal.style.display = 'flex';
    // Timeout para garantir que o CSS entenda que o display mudou, permitindo a transi√ß√£o de opacidade
    setTimeout(() => modal.classList.add('show-modal'), 10);
}

function closeNumberModal() {
    const modal = document.getElementById('numberModal');
    // CORRIGIDO: Remove a classe para acionar o fade-out
    modal.classList.remove('show-modal');
    // CORRIGIDO: Esconde completamente ap√≥s a transi√ß√£o (300ms + 10ms de margem)
    setTimeout(() => {
        modal.style.display = 'none';
    }, 310);
}

// O c√≥digo para o T√≥pico 7 (FILL_IN_BLANKS)
function loadFillInBlanks(q) {
    optionsContainer.style.display = 'block';
    optionsContainer.innerHTML = `<div class="fill-in-blanks-container"></div>`;
    const container = optionsContainer.querySelector('.fill-in-blanks-container');

    q.data.forEach((item, index) => {
        const group = document.createElement('div');
        group.className = 'number-input-group';
        
        const span = document.createElement('span');
        span.textContent = item.num;
        
        const input = document.createElement('input');
        input.type = 'text';
        input.id = `input-${index}`;
        input.placeholder = 'Write the word...';
        
        const resultDiv = document.createElement('div');
        resultDiv.className = 'number-result';
        resultDiv.id = `result-${index}`;
        
        group.appendChild(span);
        group.appendChild(input);
        group.appendChild(resultDiv);
        container.appendChild(group);
    });

    feedback.innerHTML = '<span style="color: #007bff; font-size: 1.1em;">Click Next to check your answers.</span>';
    optionsContainer.style.display = 'flex';
    optionsContainer.style.justifyContent = 'center';
}

function checkFillInBlanks(q) {
    let allCorrect = true;
    q.data.forEach((item, index) => {
        const input = document.getElementById(`input-${index}`);
        const resultDiv = document.getElementById(`result-${index}`);
        
        // Remove espa√ßos, converte para min√∫sculas e remove caracteres n√£o alfab√©ticos/h√≠fens
        const userAnswer = input.value.trim().toLowerCase().replace(/[^a-z-]/g, '');
        const correctAnswer = item.correct.toLowerCase().replace(/[^a-z-]/g, '');

        input.disabled = true;

        if (userAnswer === correctAnswer) {
            resultDiv.innerHTML = 'Correct!';
            resultDiv.className = 'number-result result-correct';
        } else {
            resultDiv.innerHTML = `Incorrect. Correct answer: <strong>${item.correct}</strong>`;
            resultDiv.className = 'number-result result-incorrect';
            allCorrect = false;
        }
    });

    if (allCorrect) {
        feedback.innerHTML = '<span style="color: #28a745; font-size: 1.2em;">All answers are correct! Click Next.</span>';
    } else {
        feedback.innerHTML = '<span style="color: #dc3545; font-size: 1.2em;">Review the corrected answers and click Next.</span>';
    }
}

// O c√≥digo para o T√≥pico 8 (DRAG_AND_DROP)
function loadDragAndDrop(q) {
    optionsContainer.style.display = 'block';
    optionsContainer.innerHTML = '';
    questionText.style.display = 'none';

    const mainContainer = document.createElement('div');
    mainContainer.className = 'drag-drop-overall-container';

    // 1. Image Gallery (Top)
    const imageGallery = document.createElement('div');
    imageGallery.className = 'image-gallery-container';
    q.data.sentences.forEach((sent, index) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'gallery-image-wrapper';
        wrapper.innerHTML = `
            <div class="image-number-label">${index + 1}</div>
            <img src="${sent.image}" alt="Image for sentence ${index + 1}">
        `;
        imageGallery.appendChild(wrapper);
    });
    mainContainer.appendChild(imageGallery);

    // 2. Sentence List (Middle)
    const sentenceList = document.createElement('div');
    sentenceList.className = 'sentence-list-container';
    q.data.sentences.forEach(sent => {
        const item = document.createElement('p');
        item.className = 'sentence-item';
        item.innerHTML = `
            <span class="sentence-text-before">${sent.text.split('____')[0]}</span>
            <div class="drop-zone" id="${sent.dropId}" data-correct-word="${sent.correct}" data-sentence-id="${sent.id}"></div>
            <span class="sentence-text-after">${sent.text.split('____')[1] || ''}</span>
        `;
        sentenceList.appendChild(item);
    });
    mainContainer.appendChild(sentenceList);

    // 3. Draggable Words (Bottom)
    const wordsContainer = document.createElement('div');
    wordsContainer.className = 'draggable-words-container';
    q.data.words.forEach(word => {
        const draggable = document.createElement('div');
        draggable.className = 'draggable-word';
        draggable.id = word.id;
        draggable.textContent = word.text;
        draggable.draggable = true;
        draggable.addEventListener('dragstart', dragStart);
        wordsContainer.appendChild(draggable);
    });
    mainContainer.appendChild(wordsContainer);
    optionsContainer.appendChild(mainContainer);

    // Adiciona listeners aos drop zones
    document.querySelectorAll('.drop-zone').forEach(dropZone => {
        dropZone.addEventListener('dragover', dragOver);
        dropZone.addEventListener('dragleave', dragLeave);
        dropZone.addEventListener('drop', drop);
    });

    feedback.innerHTML = '<span style="color: #007bff; font-size: 1.1em;">Click Next to check your answers.</span>';

    // Adiciona listeners para retornar a palavra ao container de palavras
    wordsContainer.addEventListener('dragover', dragOver);
    wordsContainer.addEventListener('dragleave', dragLeave);
    wordsContainer.addEventListener('drop', returnWordToContainer);
}

// Fun√ß√µes Drag and Drop
function dragStart(e) {
    currentDraggedElement = e.target;
    e.dataTransfer.setData('text/plain', e.target.id);
    setTimeout(() => e.target.classList.add('dragging'), 0);
}

function dragOver(e) {
    e.preventDefault();
    if (e.target.classList.contains('drop-zone')) {
        e.target.classList.add('drag-over');
    } else if (e.target.classList.contains('draggable-words-container')) {
        e.target.classList.add('drag-over');
    }
}

function dragLeave(e) {
    if (e.target.classList.contains('drop-zone')) {
        e.target.classList.remove('drag-over');
    } else if (e.target.classList.contains('draggable-words-container')) {
        e.target.classList.remove('drag-over');
    }
}

function drop(e) {
    e.preventDefault();
    e.target.classList.remove('drag-over');

    const draggableId = e.dataTransfer.getData('text/plain');
    const draggableElement = document.getElementById(draggableId);
    
    // Check if the drop target is a drop zone and is currently empty
    if (e.target.classList.contains('drop-zone') && e.target.children.length === 0) {
        // If the element was in another drop zone, move it back to the words container first
        const previousDropZone = draggableElement.closest('.drop-zone');
        if (previousDropZone) {
            document.querySelector('.draggable-words-container').appendChild(draggableElement);
        }

        // Drop the word into the new drop zone
        e.target.appendChild(draggableElement);
        draggableElement.classList.remove('dragging');
        draggableElement.style.opacity = '1';
        draggableElement.style.transform = 'none';

    } else if (e.target.classList.contains('drop-zone') && e.target.children.length > 0) {
        // Drop zone is occupied: swap the words
        const oldWord = e.target.children[0];
        const wordsContainer = document.querySelector('.draggable-words-container');

        // Put the old word back in the words container
        wordsContainer.appendChild(oldWord);
        oldWord.classList.remove('dragging');
        oldWord.style.opacity = '1';
        oldWord.style.transform = 'none';

        // Put the new word in the drop zone
        e.target.appendChild(draggableElement);
        draggableElement.classList.remove('dragging');
        draggableElement.style.opacity = '1';
        draggableElement.style.transform = 'none';

    } else {
        // Drop on another draggable word (ignore)
    }
}

function returnWordToContainer(e) {
    e.preventDefault();
    e.target.classList.remove('drag-over');
    
    // Check if the drop target is the words container itself
    if (e.target.classList.contains('draggable-words-container')) {
        const draggableId = e.dataTransfer.getData('text/plain');
        const draggableElement = document.getElementById(draggableId);
        
        // If the word is from a drop zone, put it back in the container
        if (draggableElement.closest('.drop-zone')) {
            e.target.appendChild(draggableElement);
            draggableElement.classList.remove('dragging');
            draggableElement.style.opacity = '1';
            draggableElement.style.transform = 'none';
        }
    }
}

function checkDragAndDrop(q) {
    let allCorrect = true;
    
    // Disable all draggable words after checking
    document.querySelectorAll('.draggable-word').forEach(word => word.draggable = false);

    q.data.sentences.forEach(sentenceData => {
        const dropZone = document.getElementById(sentenceData.dropId);
        dropZone.removeEventListener('dragover', dragOver);
        dropZone.removeEventListener('dragleave', dragLeave);
        dropZone.removeEventListener('drop', drop);
        
        // Ensure there is a word in the drop zone
        if (dropZone.children.length === 0) {
            allCorrect = false;
            // Display the correct word in red
            dropZone.innerHTML = `<span class="correct-word-display">${sentenceData.correct}</span>`;
            dropZone.classList.add('incorrect-drop');
            return;
        }

        const droppedWord = dropZone.children[0].textContent;
        const correctWord = dropZone.getAttribute('data-correct-word');

        // Case: Correct Answer
        if (droppedWord === correctWord) {
            dropZone.classList.add('correct-drop');
            dropZone.children[0].style.backgroundColor = '#e6ffed'; // Optional: highlight green
            sentenceData.isCorrect = true;
        } 
        // Case: Incorrect Answer
        else {
            dropZone.classList.add('incorrect-drop');
            dropZone.children[0].style.backgroundColor = '#ffe6e6'; // Optional: highlight red
            // Show the correct word below the incorrect word
            dropZone.innerHTML += `<span class="correct-word-display">${correctWord}</span>`; // Mostra a correta
            allCorrect = false;
            sentenceData.isCorrect = false;
        }
        dropZone.style.pointerEvents = 'none'; // Impede altera√ß√£o ap√≥s o check
    });

    document.querySelectorAll('.draggable-word').forEach(word => word.style.pointerEvents = 'none');

    if (allCorrect) {
        feedback.innerHTML = '<span style="color: #28a745; font-size: 1.2em;">All sentences are correct! Click Next.</span>';
    } else {
        feedback.innerHTML = '<span style="color: #dc3545; font-size: 1.2em;">Review the corrected sentences and click Next.</span>';
    }
}

// --- FUN√á√ÉO PRINCIPAL DE INICIALIZA√á√ÉO ---
document.addEventListener('DOMContentLoaded', (event) => {
    // Start on the home screen by default
    goHome();
});
</script>

</body>
</html>
